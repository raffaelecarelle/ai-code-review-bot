<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VCS Adapters • AI Code Review Bot</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
<header class="header">
  <div class="container header-inner">
    <a class="brand" href="./"><img src="assets/logo.png" alt="" /><span>AI Code Review Bot</span></a>
    <nav class="nav">
      <a href="getting-started.html">Quick Start</a>
      <a href="configuration.html">Configuration</a>
      <a href="vcs-adapters.html">VCS Adapters</a>
      <a href="providers.html">AI Providers</a>
      <a href="cli.html">CLI</a>
      <a href="development.html">Development</a>
      <a href="faq.html">FAQ</a>
    </nav>
  </div>
</header>
<main class="main container content">
  <aside class="sidebar">
    <h3>On this page</h3>
    <a href="#overview">Overview</a>
    <a href="#github">GitHub setup</a>
    <a href="#gitlab">GitLab setup</a>
    <a href="#bitbucket">Bitbucket setup</a>
    <a href="#flow">How it works without --diff-file</a>
    <a href="#comments">Posting comments</a>
    <a href="#troubleshooting">Troubleshooting</a>
  </aside>
  <article class="article">
    <h1>VCS Adapters</h1>
    <p>Use the VCS adapters to resolve a PR/MR by its ID and compute the diff automatically. Supported platforms: GitHub, GitLab, and Bitbucket.</p>

    <h2 id="overview">Overview</h2>
    <ul>
      <li>Set <code>vcs.platform</code> to <code>github</code>, <code>gitlab</code>, or <code>bitbucket</code> in your config.</li>
      <li>Configure <code>vcs.repository</code>, <code>vcs.access_token</code>, and optionally <code>vcs.api_base</code> and <code>vcs.timeout</code>.</li>
      <li>For GitLab, also set <code>vcs.project_id</code> for project identification.</li>
      <li>Use <code>${ENV_VAR}</code> syntax in config to reference environment variables.</li>
      <li>Run <code>php bin/aicr review --id &lt;number&gt; --output summary</code>.</li>
    </ul>

    <h2 id="github">GitHub setup</h2>
    <ul>
      <li>Token: <code>vcs.access_token</code> in config or <code>${GITHUB_TOKEN}</code> env variable</li>
      <li>Repository: <code>vcs.repository</code> as <code>owner/repo</code> format</li>
      <li>API Base: <code>vcs.api_base</code> (defaults to <code>https://api.github.com</code>)</li>
      <li>Permissions: read PRs; write if you plan to post comments.</li>
    </ul>

    <h2 id="gitlab">GitLab setup</h2>
    <ul>
      <li>Token: <code>vcs.access_token</code> in config or <code>${GITLAB_TOKEN}</code> env variable (uses PRIVATE-TOKEN authentication)</li>
      <li>Project ID: <code>vcs.project_id</code> as numeric ID or full path <code>namespace/repo</code></li>
      <li>Repository: <code>vcs.repository</code> (used as fallback for project identification)</li>
      <li>API Base: <code>vcs.api_base</code> (defaults to <code>https://gitlab.com/api/v4</code>, customize for self-hosted)</li>
    </ul>

    <h2 id="bitbucket">Bitbucket setup</h2>
    <ul>
      <li>Repository: <code>vcs.repository</code> as <code>workspace/repository</code> format</li>
      <li>Token: <code>vcs.access_token</code> in config or <code>${BITBUCKET_TOKEN}</code> env variable (uses Bearer authentication)</li>
      <li>API Base: <code>vcs.api_base</code> (defaults to <code>https://api.bitbucket.org/2.0</code>)</li>
      <li>Timeout: <code>vcs.timeout</code> in seconds (optional, defaults to 30)</li>
      <li>Permissions: read Pull Requests; write if you plan to post comments</li>
    </ul>

    <h2 id="flow">How it works without <code>--diff-file</code></h2>
    <ol>
      <li>Resolve base/head branches from the PR number (GitHub), MR IID (GitLab), or PR ID (Bitbucket) via the platform API.</li>
      <li>Run <code>git fetch --all</code>, fetch both branches and compute <code>git diff base...head</code>.</li>
      <li>Analyze the resulting unified diff with the pipeline.</li>
    </ol>

    <h2 id="comments">Posting comments</h2>
    <p>Pass <code>--comment</code> to post the human summary back to the PR/MR via the adapter.</p>

    <h2 id="troubleshooting">Troubleshooting</h2>
    <ul>
      <li><strong>401/403:</strong> check <code>vcs.access_token</code> presence and scopes/permissions.</li>
      <li><strong>Not found:</strong> verify <code>vcs.repository</code>/<code>vcs.project_id</code> and PR/MR ID (<code>--id</code>) correctness.</li>
      <li><strong>Self-hosted GitLab:</strong> ensure <code>vcs.api_base</code> ends with <code>/api/v4</code>.</li>
      <li><strong>Environment variables:</strong> use <code>${VAR_NAME}</code> syntax in config file to reference environment variables.</li>
    </ul>
  </article>
</main>
<footer class="footer"><div class="container footer-inner"><div>© 2025 AI Code Review Bot</div><div><a href="./">Home</a></div></div></footer>
</body>
</html>
